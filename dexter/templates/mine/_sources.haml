%%namespace(file="../dashboard/helpers.haml", **{'import': '*'})

- import itertools

%section.people
  .people-table
    %h3 People in the news

    %table.table.table-condensed.analysis
      - for i, source in enumerate(source_analyser.top_people):
        %tr(class_='active' if i == 0 else '')
          %td.rank ${i+1}.
          %td
            %a(href="#quotations-%s" % i)&= source.person.name
            %span.text-muted&= source.person.affiliation and source.person.affiliation.name or ''
          %td.sparkline(dataSparkline=','.join(str(round(i, 0)) for i in source.source_counts), dataLabel='{point.y}%')

  .quotations
    - for i, source in enumerate(source_analyser.top_people):
      .person-quotations.collapse(id="quotations-%s" % i, class_=("in" if i == 0 else ""))
        %h4
          ${i+1}. 
          &= source.person.name
          %small&= source.person.affiliation and source.person.affiliation.name or ''

        - utterances = source_analyser.person_utterances.get(source.person.id, [])
        - if utterances:
          %ul.fa-ul
            - for u in utterances:
              %li
                %i.fa.fa-li.fa-quote-left
                &= u.quote

